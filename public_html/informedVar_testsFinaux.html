<!DOCTYPE html>
<html>
<head>
    <title>Tests FINAUX pour informedvar!</title>
    <meta charset="utf-8" />
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/jquery-ui.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            var nav = "Je ne sais pas quel est le navigateur!";

            var j, i = navigator.userAgent.indexOf("Edge");
            if (i !== -1) {
                nav = navigator.userAgent.slice(i);
            }
            else {
                i = navigator.vendor.indexOf("Google");
                if (i !== -1) {
                    i = navigator.userAgent.indexOf("Chrome");
                    nav = navigator.userAgent.slice(i, navigator.userAgent.indexOf(" ", i));
                }
                else {
                    i = navigator.userAgent.indexOf("Fire");
                    if (i !== -1) {
                        nav = navigator.userAgent.slice(navigator.userAgent.indexOf("Fire"));
                    }
                    else {
                        var isIE = /*@cc_on!@*/false || !!document.documentMode;
                        if (isIE) {
                            nav = "IE probablement la version 11!"
                        }
                    }
                }
            }

            $('#navigateur').text(nav);
        });
    </script>
    <script src="js/A.js"></script>
    <script src="js/G.js"></script>
    <script src="js/U.js"></script>
    <script src="js/M0.js"></script>
    <script src="js/M0.js"></script>
    <script src="js/M2modelIntro.js"></script>
    <script src="js/M2modelPerSe.js"></script>
    <script src="js/M2modelValidation.js"></script>
    <script src="js/MT.js"></script>
    <script src="js/NUM.js"></script>
    <script src="js/O.js"></script>
    <script src="js/S.js"></script>
    <script type="text/javascript">
        zygotine.testsFinauxInformedVar = {};
        var tests = zygotine.testsFinauxInformedVar;
        tests.donneesBrutes = `label	content
expected.mu	-1.2
expected.sd	0.92
n	10
data	1.18|0.553|0.784|0.496|0.263|0.226|0.676|0.976|0.215|0.741
label	content
expected.mu	-1.2
expected.sd	0.095
n	10
data	0.256|0.308|0.291|0.291|0.329|0.261|0.287|0.29|0.288|0.276
label	content
expected.mu	-1.2
expected.sd	1.6
n	10
data	0.188|0.376|0.158|0.36|0.259|0.133|0.361|0.137|2.14|0.256
label	content
expected.mu	-1.2
expected.sd	0.92
n	50
data	0.158|0.937|0.179|0.144|0.172|0.127|0.122|0.286|0.156|0.467|0.198|0.358|0.23|0.199|0.969|0.319|0.232|0.41|0.188|0.611|0.608|0.392|0.0434|0.713|0.439|0.543|0.214|0.0663|0.53|0.771|0.555|0.796|0.209|0.125|0.581|0.0729|0.0538|0.811|0.409|0.194|1.69|0.059|0.372|0.118|0.47|0.281|0.343|0.253|1.22|2.84
label	content
expected.mu	-1.2
expected.sd	0.095
n	50
data	0.275|0.323|0.324|0.322|0.282|0.297|0.335|0.296|0.293|0.314|0.373|0.252|0.304|0.286|0.289|0.291|0.287|0.291|0.323|0.314|0.303|0.29|0.278|0.256|0.285|0.367|0.283|0.297|0.294|0.332|0.286|0.327|0.31|0.289|0.306|0.315|0.267|0.301|0.264|0.233|0.303|0.283|0.341|0.349|0.33|0.321|0.336|0.301|0.276|0.269
label	content
expected.mu	-1.2
expected.sd	1.6
n	50
data	1.2|0.0666|0.992|2.22|0.303|1.38|0.0494|0.14|14.1|0.0679|1.22|0.991|0.385|7.12|0.426|3.38|1.48|1.02|0.524|0.633|2.44|0.256|0.0899|0.0593|0.387|0.451|0.68|0.466|0.649|3.22|0.108|2.89|0.552|1.02|0.146|0.339|1.05|0.034|0.0567|0.0232|0.0909|0.455|2.33|0.107|0.0804|0.862|0.379|2.8|0.581|0.363
label	content
expected.mu	-1.2
expected.sd	0.92
n	10
data	>0.989|0.247|0.143|<0.227|0.746|0.17|1.48|<0.214|[0.113,0.255]|[0.53,1.19]
label	content
expected.mu	-1.2
expected.sd	0.095
n	10
data	0.342|[0.186,0.419]|0.272|0.322|<0.408|0.273|0.28|>0.228|<0.409|[0.191,0.431]
label	content
expected.mu	-1.2
expected.sd	1.6
n	10
data	0.272|[0.215,0.483]|[0.875,1.97]|1.27|0.322|>5.51|1.31|<0.396|1.27|<0.0567
label	content
expected.mu	-1.2
expected.sd	0.92
n	50
data	0.471|0.376|2.02|[0.251,0.564]|>0.894|0.487|>1.13|<0.0687|>0.805|[0.563,1.27]|0.23|<0.116|0.33|[0.266,0.598]|[0.272,0.612]|[0.122,0.274]|<0.214|0.844|0.114|1.34|<0.169|0.961|<0.171|0.724|0.142|0.508|[0.299,0.672]|0.493|>1.35|0.413|<0.152|1.41|1.11|1.69|0.187|[0.125,0.28]|>0.942|<0.128|[0.237,0.534]|<0.193|1.04|0.102|[0.0986,0.222]|0.534|0.0854|<0.135|0.077|[0.121,0.272]|<0.219|0.129
label	content
expected.mu	-1.2
expected.sd	0.095
n	50
data	0.293|<0.427|0.305|0.297|>0.226|0.285|0.304|0.285|0.27|<0.364|[0.193,0.433]|0.339|[0.22,0.496]|[0.195,0.44]|0.371|[0.208,0.469]|0.306|[0.202,0.456]|0.307|<0.423|0.276|<0.365|[0.198,0.445]|0.298|0.273|>0.255|[0.195,0.438]|>0.227|0.353|0.282|0.337|[0.212,0.478]|<0.414|0.29|<0.428|>0.248|<0.362|0.316|>0.235|0.326|[0.213,0.479]|0.293|0.316|0.332|[0.224,0.505]|0.285|<0.423|<0.41|<0.404|0.315
label	content
expected.mu	-1.2
expected.sd	1.6
n	50
data	<0.0394|[0.757,1.7]|1.26|[0.109,0.246]|[0.199,0.447]|[0.133,0.3]|3.55|0.726|[0.579,1.3]|0.0814|0.164|[0.837,1.88]|>1.66|0.298|0.0174|<0.026|0.2|>2.37|0.147|[0.0792,0.178]|0.0518|<0.0203|0.0263|0.119|>2.37|[0.11,0.247]|0.0207|1.14|<0.00946|>1.07|[0.246,0.553]|<0.0494|0.232|0.206|>2.05|<0.0879|0.358|0.00631|[0.484,1.09]|<0.0311|0.353|<0.0198|0.174|0.485|0.43|<0.0776|0.172|3.07|<0.00102|0.369
label	content
expected.mu	85
expected.sd	5
n	10
data	91|86.7|77.6|78.6|77.2|82.5|83.4|90.3|81.1|82.3
label	content
expected.mu	85
expected.sd	0.1
n	10
data	85|85|85.2|85.1|85.1|85|84.9|84.9|85|85
label	content
expected.mu	85
expected.sd	20
n	10
data	112|101|105|66.9|76.5|114|45.4|49.1|65.4|71.9
label	content
expected.mu	85
expected.sd	5
n	50
data	83.4|88.3|82.6|86.9|82.2|93.1|89.2|86.7|89.9|87|86.3|89.7|81.2|88.3|85.3|84|91.9|77.5|82|75.7|87.7|88.1|86.4|89.6|86.4|80.1|88.9|80.7|90.8|81.6|90.8|87|92.1|90.3|83.6|85.3|81.8|81.5|88.2|87.5|82.4|89.7|81|82.3|85.2|90.5|91.3|89.6|86|91
label	content
expected.mu	85
expected.sd	0.1
n	50
data	84.9|85.1|85.2|84.9|85|85|85|85|85|84.9|84.9|85|85.1|84.9|85|85|84.8|85.1|84.9|85|85.2|85|85|85.1|85|85|84.9|85.1|85.3|84.9|85|84.9|85.2|85|85|85.2|85|84.9|84.9|85.1|84.9|85.1|85.1|85|85.1|85|85.1|85.2|84.9|85
label	content
expected.mu	85
expected.sd	20
n	50
data	68.7|60.2|80.6|102|95.8|76.5|112|74.8|115|70.2|46.1|100|102|96.7|63.5|105|89.9|77.1|112|104|74.9|64.7|101|63.9|65.5|79.8|83.6|90.8|90.1|81.1|74.6|87.4|86.6|52.2|70.6|108|102|93.7|72.9|90.7|103|74|75.8|77.8|92.6|53.7|56.1|73.1|59.6|115
label	content
expected.mu	85
expected.sd	5
n	10
data	<87.6|[80.7,90.7]|85|93.5|>88.5|85.7|[80,90]|<82.5|82.6|77.5
label	content
expected.mu	85
expected.sd	0.1
n	10
data	84.8|85.2|[80.1,90.1]|<89.8|84.9|[80.1,90.1]|<89.8|85.1|85.1|>80.2
label	content
expected.mu	85
expected.sd	20
n	10
data	<86.4|81.4|[85.5,95.5]|<89.8|>104|84.8|88|[98.5,108]|103|90.5
label	content
expected.mu	85
expected.sd	5
n	50
data	<84.8|92.2|[82,92]|<79.4|82.1|89.8|[76,86]|87|>87.2|<80.3|81.4|>87.3|86.8|75.3|[83,93]|[79.9,89.9]|77|[79.2,89.2]|<85.4|[75.5,85.5]|>89.3|>87|80.9|84.2|74.6|[77.2,87.2]|83.2|85.8|80.5|80.5|85.9|>87.7|84.9|<80.3|[80.8,90.8]|82.6|92|<83.5|<79.6|85.3|87.6|<82|85.3|85.5|<78.5|79.8|[80.4,90.4]|<84.3|80.9|[82.6,92.6]
label	content
expected.mu	85
expected.sd	0.1
n	50
data	85|84.8|>80.2|>80.2|<89.8|[80.1,90.1]|[80.1,90.1]|85|<89.9|<89.9|<89.8|84.9|84.8|<89.8|[80,90]|<89.8|85|85|>80.2|85.1|85.1|85|85|84.8|[80.1,90.1]|[79.9,89.9]|85.1|<89.8|[79.9,89.9]|84.8|85.1|<89.7|85|<89.8|>80.2|85|85|[80.1,90.1]|[80,90]|84.7|[79.9,89.9]|85|[80,90]|85|84.9|85.1|<89.8|85|>80.3|84.8
label	content
expected.mu	85
expected.sd	10
n	50
data	<78.1|>100|<77.5|88.4|<67.8|98|[81,91]|<77.2|[94.1,104]|87.1|98.9|<76.8|72.2|[93,103]|<70.6|[91.4,101]|73.2|93.4|65.6|>106|<61.9|[74.6,84.6]|>103|79.1|[74.1,84.1]|56.9|78.9|100|<74.9|>97.5|[74.1,84.1]|77.7|[85.7,95.7]|103|<78.2|94.5|74.6|86.2|99.1|[71.2,81.2]|87.6|86|80.3|83|89.6|>98.2|79.6|<79.3|76.2|[84.6,94.6]`;


        tests.DonneeFinale = function (chaine, mu, sd, n, ordi) {
            this.chaine = chaine;
            this.logN = ordi <= 12;
            this.mu = parseFloat(mu);
            this.sd = parseFloat(sd);
            this.decompte = parseInt(n);
            this.ordinal = ordi;
        }

        tests.DonneeFinale.prototype.toCSV = function () {
            var a = [];
            a.push("mesures\t" + this.chaine);
            a.push("n mesures\t" + (this.decompte));
            a.push("logN\t" + (this.logN ? "vrai" : "false"));
            a.push("valeurs attendues\tmu\t" + (this.mu) + "\tsd\t" + (this.sd));
            return (a.join('\n'));
        };

        tests.dataFinal = (function () {
            var lignes = tests.donneesBrutes.split("\n");
            var rep = [];
            var iL = 0;
            var ordi = 1;
            while (typeof lignes[iL] !== "undefined") {

                //data
                let mu = lignes[++iL].split("\t")[1];
                let sd = lignes[++iL].split("\t")[1];
                let n = lignes[++iL].split("\t")[1];
                let chaine = lignes[++iL].split("\t")[1];
                let donnee = new tests.DonneeFinale(chaine, mu, sd, n, ordi);
                rep.push(donnee);
                iL++;
                ordi++;
            }

            return rep;
        })();

        tests.pastData = [
            {
                logN: new zygotine.M.PastDataSummary((Math.log(1)) + ";" + (Math.log(2.4)) + ";10"), norm: zygotine.M.PastDataSummary.dummyPDS,
                norm: new zygotine.M.PastDataSummary("90;5;10")
            },
            {
                logN: new zygotine.M.PastDataSummary((Math.log(2)) + ";" + (Math.log(2)) + ";100"), norm: zygotine.M.PastDataSummary.dummyPDS,
                norm: new zygotine.M.PastDataSummary("100;3;100")
            }]


        tests.getPastData = function (logN, modeleNo) {
            if (modeleNo === 0) {
                return zygotine.M.PastDataSummary.dummyPDS;
            }

            return tests.pastData[modeleNo - 1][logN ? "logN" : "norm"];
        }

        tests.pds = {
            aucun: zygotine.M.PastDataSummary.dummyPDS
        }

        tests.specificParametersToCSV = function(p) {
            return ["params", "initMu", p.initMu, "initSigma", p.initSigma, "logSigmaMu", p.logSigmaMu, "logSigmaPrec", p.logSigmaPrec, "muRange", p.muLower, p.muUpper].join("\t");
        }

        tests.unTest = function (info, noModelePDS, firstSeed, repetitions, justeUnPeu) {
            // tests.dataFinal
            var mlStr;
            var mcmc = zygotine.M.McmcParameters.getDefaults();
            mcmc.nBurnin = 5000;
            mcmc.nIter = 50000;
            if (typeof justeUnPeu !== "undefined") {
                mcmc.nBurnin = 0;
                mcmc.nIter = 5000;
            }

            mcmc.monitorBurnin = true;
            var measures;
            var specificParameters;
            var pdsParameters;
            var model;
            var resultat;
            var retVal = { mu: [], sd: [], prngSeed: [], params: {}, pds: "" };
            retVal.mcmc = mcmc;
            var logN = info.logN;
            var prngSeed = firstSeed;
            if (typeof prngSeed === 'undefined') {
                prngSeed = 12;
            }

            let oel = logN ? 1 : 90;
            specificParameters = new zygotine.M.SEGInformedVarModelParameters(logN, oel);
            retVal.params = specificParameters;
            pdsParameters = tests.getPastData(logN, noModelePDS);
            retVal.pds = pdsParameters.toString();
            measures = new zygotine.M.MeasureList(info.chaine);

            for (let iRepetitions = 0; iRepetitions < repetitions; iRepetitions++) {
                let oel = logN ? 1 : 90;
                model = new zygotine.M.SEGInformedVarModel(measures, specificParameters, mcmc, pdsParameters);
                resultat = model.compute(prngSeed);
                retVal.prngSeed[iRepetitions] = resultat.prngSeed;
                var q = new zygotine.S.Quantile(resultat.quantileProbs);
                console.log(info.ordinal + " " + iRepetitions);
                retVal.mu[iRepetitions] = q.compute(resultat.chains.muSample.data);
                retVal.sd[iRepetitions] = q.compute(resultat.chains.sdSample.data);
                prngSeed++;
            }

            retVal.muMean = new Array(9);
            retVal.sdMean = new Array(9);
            retVal.muStdDev = new Array(9);
            retVal.sdStdDev = new Array(9);
            for (let iQ = 0; iQ < 9; iQ++) {
                let MU = new Array(repetitions);
                let SD = new Array(repetitions);
                for (let iRepetitions = 0; iRepetitions < repetitions; iRepetitions++) {
                    MU[iRepetitions] = retVal.mu[iRepetitions][iQ];
                    SD[iRepetitions] = retVal.sd[iRepetitions][iQ];
                }

                retVal.muMean[iQ] = zygotine.U.mean(MU);
                retVal.sdMean[iQ] = zygotine.U.mean(SD);
                if (repetitions > 9) {
                    retVal.muStdDev[iQ] = Math.sqrt(zygotine.U.variance(MU));
                    retVal.sdStdDev[iQ] = Math.sqrt(zygotine.U.variance(SD));
                }
            }

            var txt = [];
            txt.push(info.toCSV());
            txt.push("mcmc\tnBurnin\t" + mcmc.nBurnin + "\tnIter\t" + mcmc.nIter);
            txt.push(tests.specificParametersToCSV(specificParameters));
            txt.push("pastData\t" + (!pdsParameters.defined ? "non défini" : ("mean\t" + (pdsParameters.mean) + "\tsd\t" + (pdsParameters.sd) + "\tn\t" + (pdsParameters.n))));
            txt.push("onglet\t" + (info.ordinal) + "-infVar" + (pdsParameters.defined ? "-pd" + (noModelePDS) : ""));
            txt.push("\n");
            txt.push("moyennes\tmu\t" + retVal.muMean.join("\t"));
            txt.push("\tsd\t" + retVal.sdMean.join("\t"));
            if (repetitions > 2) {
                txt.push("Écarts\tmu\t" + retVal.muStdDev.join("\t"));
                txt.push("\tsd\t" + retVal.sdStdDev.join("\t"));
            }

            for (let iRepetitions = 0; iRepetitions < repetitions; iRepetitions++) {
                txt.push(retVal.prngSeed[iRepetitions] + "\tmu\t" + retVal.mu[iRepetitions].join("\t"));
                txt.push("\tsd\t" + retVal.sd[iRepetitions].join("\t"));
            }

            retVal.txt = txt.join("\n");
            delete retVal.mu;
            delete retVal.sd;
            return retVal;
        };

        tests.doNTests = function (infoA, noModelePDS, firstSeed, repetitions, unPeu) {
            var reponse = [];
            infoA.forEach(info => reponse.push(tests.unTest(info, noModelePDS, firstSeed, repetitions, unPeu)));
            return reponse;
        };

        tests.multiQuantiles = function(muData, sdData, size = 50000,  step = 5000) {

            let start = 0;
            let rep = [];
            let mu ;
            let sd ;
            let quantileProbs = [ 0.5];
            let q = new zygotine.S.Quantile(quantileProbs);
            let n = muData.length;
            while ((start + size) < n) {
                rep.push(q.compute(muData.slice(start, start + size)) + "\t" + q.compute(sdData.slice(start, start + size)));
                start += step;
            }

            rep = rep.join("\n"); 
            return rep;
        }

    </script>
</head>
<body>
    <div id="navigateur" style="width:20em; text-align:center; font-size:120%; color:darkred;"></div>
    <div>
        <pre>
            C:\Users
                \zygot
                \Documents
                \_aBKP
                \_jerome
                \webExpo2015
                \vs2-2018JS-6 -202002bug
                \pourCorrectionsFevrier2020
                \corrections202002
                \outil7
                \informedVar_testsFinaux.html
        </pre>

    </div>
</body>
</html>
